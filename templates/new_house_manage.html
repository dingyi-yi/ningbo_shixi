<!DOCTYPE html>
<!-- 
Template Name: Deepor - Responsive Bootstrap 4 Admin Dashboard Template
Author: Hencework

License: You must have a valid license purchased only from templatemonster to legally use the template for your project.
-->
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Deepor I Media Object</title>
    <meta name="description" content="A responsive bootstrap 4 admin dashboard template by hencework" />
	 {% load static %}
	<link rel="stylesheet" href="{% static 'dist/css/layui.css' %}" >
	  <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
	  <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <style type="text/css">
	    .low_right
	    {
		  position: fixed;
		  width: 100px;
		  height: 100px;
		  bottom: 100px;
		  right: 100px;                        
		  text-align: center;
		  padding: 10px;
		  margin: 10px;
	    }
    </style>
	<style type="text/css">
	    #panel {
	        position: fixed;
	        background-color: white;
	        max-height: 90%;
	        overflow-y: auto;
	        top: 10px;
	        right: 50px;
	        width: 350px;
	    }
	    #panel .amap-call {
	        background-color: #009cf9;
	        border-top-left-radius: 4px;
	        border-top-right-radius: 4px;
	    }
	    #panel .amap-lib-transfer {
	        border-bottom-left-radius: 4px;
	        border-bottom-right-radius: 4px;
	        overflow: hidden;
	    }
		
	</style>
	
  
</head>

<body>
    
    <div class="container-fluid mt-xl-20 mt-sm-30 mt-15">
	      
            <!-- Container -->
            <div class="container">
                <!-- Title -->
                <div class="hk-pg-header">
                	<h2 class="hk-pg-title">楼盘信息管理</h2>
                </div>
                <!-- /Title -->
			
                <!-- Row -->
				
				<div class="layui-form-item">
				    
						
				    <div class="layui-inline">
				          <label class="layui-form-label">范围</label>
				          <div class="layui-input-inline" style="width: 100px;">
				            <input type="number" name="s_price_min" id="s_price_min" placeholder="￥" autocomplete="off" class="layui-input">
				          </div>
				          <div class="layui-form-mid">-</div>
				          <div class="layui-input-inline" style="width: 100px;">
				            <input type="number" name="s_price_max" id="s_price_max" placeholder="￥" autocomplete="off" class="layui-input">
				          </div>
				     </div>
					
					
					<div class="layui-inline">
					      <label class="layui-form-label">地区</label>
					      <div class="layui-input-inline">
					        <select name="modules" lay-verify="required" lay-search="" name="s_adress1" id="s_adress1">
					          <option value="江岸" >江岸区</option>
					          <option value="江汉" >江汉区</option>
					          <option value="硚口" >硚口区</option>
					          <option value="汉阳" >汉阳区</option>
					          <option value="武昌" >武昌区</option>
					          <option value="青山" >青山区</option>
					          <option value="洪山" >洪山区</option>
					          <option value="蔡甸" >蔡甸区</option>
					          <option value="江夏" >江夏区</option>
					          <option value="黄陂" >黄陂区</option>
					          <option value="新洲" >新洲区</option>
					          <option value="东西湖" >东西湖区</option>
					          <option value="汉南" >汉南区</option>
					        </select>
					      </div>
					</div>
					
					<div class="layui-inline">
					      <label class="layui-form-label">状态</label>
					      <div class="layui-input-inline">
					        <select name="modules" lay-verify="required" lay-search="" id="s_state" name="s_state">
					          <option value="1" >在售</option>
					          <option value="2" >待售</option>
					          <option value="0" >售罄</option>
					        </select>
					      </div>
					</div>
					
					<div class="layui-inline">					      					     
					    <button type="button" class="layui-btn layui-btn-normal" id="searchbut">搜索</button>					      
					</div>
										
				 </div>
				  
				  
                <div class="row">
              
					<div class="col-xl-12">
						
						<div class="hk-row">
							
							
							<table class="layui-hide" lay-filter="test" id="test"></table>
							<script  type="text/html" id="barDemo">
								<button type="button" class="layui-btn layui-btn-sm" lay-event="edit">编辑</button>
							   
							     <button type="button" class="layui-btn layui-btn-warm layui-btn-sm " lay-event="led" >导航</button>
								<button type="button" class="layui-btn layui-btn-danger layui-btn-sm" lay-event="del" >删除</button>
							</script>
						</div>
						 
					</div>
					
				</div>
                <!-- /Row -->
            </div>
            <!-- /Container -->
	</div>	
	
	

	<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="new-house-manage-modal">
	  <div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h2 id="modal-title" ></h2>            
					<h4 id="new-house-manage-id" class="hidden"></h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">						
					<form class="form-horizontal" id="new-house-manage-modal-form"> 
						
				
						 <div class="form-group">
						   <label for="new-house-manage-name" class="col-xs-4 control-label">名称</label>
						   <div class="col-xs-12">
							 <input type="text" class="form-control" id="new-house-manage-name" name="new-house-manage-name" >
						   </div>
						 </div>
						 
						 <div class="form-group">
						   <label for="build-adress" class="col-xs-4 control-label">地址</label>
						   <div class="col-xs-6">
								<select class="form-control" id="new-house-manage-adress1" name="new-house-manage-adress1">
									<option value="江岸" >江岸区</option>
									<option value="江汉" >江汉区</option>
									<option value="硚口" >硚口区</option>
									<option value="汉阳" >汉阳区</option>
									<option value="武昌" >武昌区</option>
									<option value="青山" >青山区</option>
									<option value="洪山" >洪山区</option>
									<option value="蔡甸" >蔡甸区</option>
									<option value="江夏" >江夏区</option>
									<option value="黄陂" >黄陂区</option>
									<option value="新洲" >新洲区</option>
									<option value="东西湖" >东西湖区</option>
									<option value="汉南" >汉南区</option>
								</select>
								<input type="text" class="form-control" id="new-house-manage-adress2" name="new-house-manage-adress2">
						   </div>
																																																				   
						 </div>
						 
						 <div class="form-group">
						   <label for="new-house-manage-acreage" class="col-xs-4 control-label">面积</label>
						   <div class="col-xs-12">
							 <input type="text" class="form-control" id="new-house-manage-acreage" name="new-house-manage-acreage" >
						   </div>
						 </div>
						 
						 <div class="form-group">
						   <label for="new-house-manage-housetype-list" class="col-xs-4 control-label">房屋结构</label>
						   <div class="col-xs-12">
							 <input type="text" class="form-control" id="new-house-manage-housetype-list"  name="new-house-manage-housetype-list">
						   </div>
						 </div>
						 
						 <div class="form-group">
						   <label for="new-house-manage-average-price" class="col-xs-4 control-label">均价</label>
						   <div class="col-xs-12">
							 <input type="number" class="form-control" id="new-house-manage-average-price" name="new-house-manage-average-price">
						   </div>
						 </div>
						 
						 
						 <div class="form-group">
						   <label for="new-house-manage-average-price" class="col-xs-4 control-label">类型</label>
						   <div class="col-xs-12">
						 		<select class="form-control" id="new-house-manage-house-kind" name="new-house-manage-house-kind">
						 			<option value="住宅" >住宅</option>
						 			<option value="别墅" >别墅</option>
						 			<option value="商业类" >商业类</option>
						 			<option value="写字楼" >写字楼</option>
						 			<option value="底商" >底商</option>						 			
						 		</select>
						   </div>
						 </div>
						 
						 
						 <div class="form-group">
						   <label for="new-house-manage-average-price" class="col-xs-4 control-label">状态</label>
						   <div class="col-xs-12">
						 		<select class="form-control" id="new-house-manage-state" name="new-house-manage-state">
						 			<option value="在售" >在售</option>
						 			<option value="待售" >待售</option>
						 			<option value="售罄" >售罄</option>
						 								 			
						 		</select>
						   </div>
						 </div>
						 
						 
						 
						 <div class="form-group">
						   <label for="new-house-manage-advantage" class="col-xs-4 control-label">优点</label>
						   <div class="col-xs-12">
							 <input type="text" class="form-control" id="new-house-manage-advantage" name="new-house-manage-advantage" >
						   </div>
						 </div>
						 		                 		              		                 
					</form> 
				</div>
				
				<div class="modal-footer">																						
					<button type="button" class="btn btn-primary" id="new-house-manage-modal-but">修改</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>

	
	
	<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="lead-modal">
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content" style="width:1100px;right: 25%;height: 700px;">
				<div class="modal-header">
					<h2 id="modal-title" ></h2>            
					<h4 id="new-house-manage-id" class="hidden"></h4>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">						
					<div id="container" style="height: 600px;"></div>
					<div id="panel"></div>
				</div>
				
				<div class="modal-footer">																						
					<button type="button" class="layui-btn layui-btn-normal" data-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>

	
	
	<script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
	<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=9d85e84c128115bb394d9b3f4164fa9a&plugin=AMap.ToolBar,AMap.Driving,AMap.Transfer"></script> 
	
	 <script>
			
	        layui.use(['table','form'], function(){
	            var table = layui.table;
	            var form = layui.form;
	            var mainIndex;
	            window.tableIns=table.render({
	                elem: '#test'
	                ,url:'/managesit/newhousetabledata/'
	                ,limit:10
	                ,limits:[5,10,20]
	                ,cols:[[
	                    {type:'checkbox',fixed:'left'},
	                    {field: 'id', title: 'ID', sort: true, fixed: 'left'},
						{field: 'name', title: '标题'},
						{field: 'adress1', title: '区域'},
						{field: 'adress2', title: '地址'},
						{field: 'acreage', title: '建面'},
						{field: 'housetype_list', title: '房屋结构'},
						{field: 'house_kind', title: '类型'}, 
						{field: 'average_price', title: '均价'},
	                    {field: 'advantage', title: '优势'},
						 {field: 'state', title: '状态'},	                          					
	                    {title:'操作',minWidth:'200',algin:'center',toolbar:'#barDemo'}
	                ]]
	                ,page:true
	            });
		
	            //表格的事件监听
	            table.on('tool(test)', function(obj){
	                var data = obj.data;//取到触发事件这一行的数据	               
	                if(obj.event === 'del'){						
						if(confirm("是否删除该信息")!==true){
							return false;
						}else{
							$.ajax({
							    url: "/managesit/deletebuildinfo/",
							    type: "POST",
							    data:{"id":data.id},
							    dataType: "json",
							    success: function(data){
							        obj.del();
							        layer.close(index);
							        layer.msg("删除成功", {icon: 6});
							        tableIns.reload();
							    },
							    error:function (data) {
							        layer.msg("删除失败", {icon: 5});
							    }
							});
						}												
	                } else if(obj.event === 'edit'){
	                    // openUserUpdate(data);
						$("#new-house-manage-modal").modal('show');
						$("#modal-title").html("楼盘信息编辑");
						$("#new-house-manage-modal-but").html("保存");
												
						$("#new-house-manage-name").val(data.name);
						$("#new-house-manage-adress1").val(data.adress1);
						$("#new-house-manage-adress2").val(data.adress2);
						$("#new-house-manage-acreage").val(data.acreage);
						$("#new-house-manage-housetype-list").val(data.housetype_list);
						$("#new-house-manage-house-kind").val(data.house_kind);
						$("#new-house-manage-average-price").val(data.average_price);
						$("#new-house-manage-advantage").val(data.advantage);																																		
						$("#new-house-manage-state").val(data.state);						
	
							
							
						$("#new-house-manage-id").html(data.id);
										
	                }else if(obj.event === 'led'){
						$("#lead-modal").modal('show');
						$("#modal-title").html("导航");
						
						var map = new AMap.Map("container", {
						    resizeEnable: true,
						    center: [116.397428, 39.90923],
						    zoom: 13 
						});
						var transOptions = {
						    map: map,
						    city: '武汉市',
						    panel: 'panel',                           
						    policy: AMap.TransferPolicy.LEAST_TIME //乘车策略
						};
						//构造公交换乘类
						var transfer = new AMap.Transfer(transOptions);
						//根据起、终点名称查询公交换乘路线
						transfer.search([
						    {keyword: '武汉理工余家头校区',city:'武汉'},
						    //第一个元素city缺省时取transOptions的city属性
						    {keyword: data.adress1+data.adress2,city:'武汉'}
						    //第二个元素city缺省时取transOptions的cityd属性
						], function(status, result) {
						    // result即是对应的公交路线数据信息，相关数据结构文档请参考  https://lbs.amap.com/api/javascript-api/reference/route-search#m_TransferResult
						    if (status === 'complete') {
						        log.success('绘制公交路线完成')
						    } else {
						        log.error('公交路线数据查询失败' + result)
						    }
						});
					}
	            });
	            
				$(document).on('click',"#searchbut",function(){
					var  price_min=$("#s_price_min").val()
					var  price_max=$("#s_price_max").val()
					var  adress1=$("#s_adress1").val()
					var  state=$("#s_state").val()
					
					
					table.reload('test',{	
							method: 'get',
							url:'/managesit/newhousetabledatasracrch/',
							where: {
								"price_min": price_min,
								"price_max":price_max,
								"adress1":adress1,
								"state":state
							}
							,page: {
								curr: 1
							}				
					});			
					
				});
																									
	        });
																
							
			//添加新的信息					
			$("#add-new-house-manage").click(function(){
				$("#new-house-manage-modal").modal('show');
				$("#modal-title").html("添加新楼盘信息");
				
				$("#new-house-manage-modal-form")[0].reset();
				$("#new-house-manage-modal-but").html("提交");
			})						
			
			//更新或者保存一条信息			
			$("#new-house-manage-modal-but").click(function(){
				if($("#modal-title").html()==="楼盘信息编辑"){
					var data=getFormData("#new-house-manage-modal-form");
					console.log(data);
					var id=$("#new-house-manage-id").html();
					data["id"]=id
					$.ajax({
						url: "/managesit/updatebuildinginfo/",
						type: "POST",
						data:data,
						dataType: "json",
						success: function(data){
							if(data.code===1){
								window.tableIns.reload();
								$("#new-house-manage-modal").modal('hide');
							}
						   
						},						
					})
					
				}else{
					var data=getFormData("#new-house-manage-modal-form");					
					$.ajax({
						url: "/managesit/addbuildinginfo/",
						type: "POST",
						data:data,
						dataType: "json",
						success: function(data){
							if(data.code===1){
								window.tableIns.reload();
								$("#new-house-manage-modal").modal('hide');
							}
						   
						},						
					})
				}
			})
	    
			 
			
		
		</script>
   

</body>	
	<!-- /HK Wrapper -->
	<div class="low_right" id="add-new-house-manage" >
		<svg t="1628184816451" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6367" width="100" height="100"><path d="M512 0c282.752 0 512 229.248 512 512s-229.248 512-512 512S0 794.752 0 512 229.248 0 512 0z m0 213.333333a42.666667 42.666667 0 0 0-42.666667 42.666667v213.333333H256l-4.992 0.298667A42.666667 42.666667 0 0 0 256 554.666667h213.333333v213.333333l0.298667 4.992A42.666667 42.666667 0 0 0 554.666667 768v-213.333333h213.333333l4.992-0.298667A42.666667 42.666667 0 0 0 768 469.333333h-213.333333V256l-0.298667-4.992A42.666667 42.666667 0 0 0 512 213.333333z" fill="#008df0" p-id="6368"></path></svg>
	</div>
		

</html>